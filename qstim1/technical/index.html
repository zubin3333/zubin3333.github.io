<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../img/favicon.ico">

    
    <title>Technical Information - QStim Manual</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="..">QStim Manual</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../quickstart/">Quick Start Guide</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Manual <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../hardware/">Hardware Overview</a>
</li>

                        
                            
<li >
    <a href="../usbinterface/">USB Interface</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../shell/">Software Manual</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Technical Information</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../shell/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li class="disabled">
                        <a rel="next" >
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#technical-information">Technical Information</a></li>
            <li class="second-level"><a href="#calibration">Calibration</a></li>
                
                <li class="third-level"><a href="#calibration-system-overview">Calibration System Overview</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="technical-information">Technical Information</h1>
<p>This document covers technical information regarding the device, that may be of interest to the advanced user or researcher that needs to understand  how the device works at the low levels. The information in here is not required to be read in order to use the device in most circumstances. The quick start guide and user manuals should be the first place to look for help.</p>
<h2 id="calibration">Calibration</h2>
<p>The Qstim uses both DACs and ADCs to move between the analog and digital domains on the device. The DAC is responsible for converting a current value that is input by the user into a voltage value that is fed to an onboard voltage controlled current source (VCCS) that produces the current output to one of the four outputs on the device. The ADCs are responsible for turning the voltages produced by circuitry that measures channel voltage and current into integer values that can be handled and processed by the processor. In an ideal world where all the electrical components used perfectly match their specified values and the data converter is absolutely linear, the relationship between the data converters digital and analog value is simple and constant across all the devices that have been manufactured. In the real world, this relationship is more complex and varies from device to device. In order to compensate for these differences, the devices have had to incorporate a calibration system that allows each of them to be calibrated according its unique hardware characteristics.</p>
<h3 id="calibration-system-overview">Calibration System Overview</h3>
<p>The calibration data is device specific, it depends on the culmination of errors in the electrical components present on the board. For this reason, this data is not built into the firmware, but is stored on an I2C EEPROM present on the device. This makes it easy for the user to re-calibrate the device themselves through the Shell interface Shell Manual. The use of an external EEPROM allows the firmware to stay consistent across all the devices in circulation and makes EEPROM failure a simpler and more cost effective issue to deal with. The EEPROM is completely managed by the processor on board the device, there is no need to use an external programmer to load calibration data, it is both written and read through the devices processor.</p>
<h4 id="calibration-paradigm">Calibration Paradigm</h4>
<p>Calibration revolves around mapping a data converter value to a physical property that is being measured or produced either directly or indirectly by the data converter. If the relationship between the two is linear, then all that is required is a some offset and scale value (y = mx+b) to map between the two. If the relationship isn't linear then it can get more complicated. While a mathematical expression relating the two nicely might exist. The development/evaluation of that expression in a reasonable time, might not be possible on a microprocessor with limited performance. A popular calibration paradigm on microprocessors involves lookup tables (LUTs). A LUT stores the physical property value that should be measured/ produced by the data converter for every single input/output level of the data converter. The performance overhead is tiny for the processor to translate between the two values, but comes at the cost of memory consumption. A 12-bit data converter (the resolution of all the data converters used in the device), requires a LUT with 4096 entries to map each level. Due to the large number of data converters used in this device, LUTs could not be implemented. The paradigm chosen was a combination of both the LUT and linear offset and scale. A low density lookup table that maps regularly spaced points in the data converter/physical property relationship is used and linear interpolation is used between the points. Naturally the higher the point density, the more accurate the conversion. This density is controlled by the firmware and has been set to ensure that enough memory is present for other processes. A graphical representation of this paradigm can be seen below.
<html>
<div style="text-align:center;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="500px" height="380px" viewBox="-0.5 -0.5 387 258" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2020-07-01T14:23:39.672Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36&quot; version=&quot;13.3.5&quot; etag=&quot;sR1uQvMUu5bnRozs6O1y&quot; type=&quot;google&quot;&gt;&lt;diagram id=&quot;AZJpvj42-SlghTPQ5Hyr&quot;&gt;7ZpZc5swEIB/jV87CDCxH2MnbjvTTjNNj2cFZJspRlSI2O6v78oSl8AHBDxtSDyTgfXq2m9XWi+MrPlm957haP2ZeiQYmYa3G1l3I9McO2P4LwR7KbAMQwpWzPekCOWCR/8PkUJHCRPfI3FJj1MacD8qC10ahsTlJRlmjG7LaksalAeN8IpUBI8uDqrSn77H11I6GRu5/APxV+t0ZJQub4NTZSWI19ij24LIuh9Zc0Ypl1eb3ZwEwnSpWWS7xZFvs4kxEvJLGpiywTMOErU2NS++TxdLQu9W2Azu3ADHse+OrNmabwIQILiUDYhXMVk+B5StDByC0A3hbA8q29x2qenWBbOlMkYCzP3ncvdYIVxl3WUjPFAfBjYN5WzItmQT5Wu2ZZa7iGnCXKJaFW11piMTaR1xzFaEVzqCi8Kyc9EBRT0W6w3LxVjsmzMddYfFrmC5u4VGxo+DQCfEyY6XmcSc0V9kTgPKQBLSEDRnSz8INBEO/FUowAIqAvLZM2Hch/3nVn2x8T1PDDPbrn1OHiPsijG3sNeCjNEk9IiYspH5geiA7Jp6QtrAOOL4BU+xazwl3eTqnKJE4YTJxxWTf0l4lABJJxDWfWJwtRJXD4xGsMr96+VgpwbNPH1yNQ5OzY4kCSzpIRpdZToQ/07E8QUrhmPdMJbLokiyMtLGMKxsL+Wvl50eQ/YVY+imU3a2MR0PHh/E4tXwTRolA8p+BZPDlyqDRsIabsKeD6bJcaRJbBWQ8oPFYsgZRQb7TEYBCPC+oBYJhfj4hE2kjeOYp+el7yFGSR8u5AzapjfTFzraBc60WKA5rKI+QgfhWrbmWtoG0ZFroalZGseynZPzyuaR6ivXPKo/mWj605P6luVo87k5rT8p28kaG6ftamnrRd2GBjI6PUO/Eix6/3rwShrGaz8a3JGaHWxpKIyvl80i1P9WNzt8/ofNTdsr2hdIKpvO5KLNrU08mm8Aj27erQFWT4HLEp82AJuVuF45QO00bQ+wciz3F4HVYthwAerpTWuA1TypP4DV0tqAAWr5ZnuARxLXPgC2q8ktl2gqnkfpOelHkRVGVGak0PiJ8C0h4urT92+ClfrJ4eCNyAfDpziSrfX7YaWxllM+M82pcoBrpLF1lb2hhjCE7Duj8Ie6CejT3faZITWr++UPAWOYAz/5bPA45KpD/OvYK79e0sTkpclvpaMO0TartA0V7VkibdPiHtGadYWiN7SNibRNmPtE26xoNFS0Z4m0TaX7RGu+oW3zGKQtWjRFV0Pb9l2qYaE9G2zd5Mt9gm5WkBoq6IZ8LsY+uVr2XPNO2CV1j6fDp+5Z3CoJMINmhwoI9BoProhh2lrVylFnePdFDLjNX2+W9PNXxK37vw==&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><path d="M 40 227 L 40 13.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 40 8.12 L 43.5 15.12 L 40 13.37 L 36.5 15.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 40 227 L 363.63 227" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 368.88 227 L 361.88 230.5 L 363.63 227 L 361.88 223.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="0" y="7" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 17px; margin-left: 1px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DAC Value</div></div></div></foreignObject><text x="20" y="21" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">DAC Va...</text></switch></g><rect x="317" y="233" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 243px; margin-left: 318px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Output<br />Property</div></div></div></foreignObject><text x="337" y="247" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Output...</text></switch></g><rect x="0" y="207" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 217px; margin-left: 1px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#0000ff">0</font></div></div></div></foreignObject><text x="20" y="221" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">0</text></switch></g><rect x="0" y="37" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 47px; margin-left: 1px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#0000ff">4095</font></div></div></div></foreignObject><text x="20" y="51" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">4095</text></switch></g><path d="M 40 227 Q 110 57 205 127 Q 300 197 370 37" fill="none" stroke="#0000ff" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 40 227 L 89 141 L 137 108 L 185 114 L 233 142 L 281 145 L 329 107 L 371 35" fill="none" stroke="#ff1c03" stroke-miterlimit="10" pointer-events="stroke"/><rect x="125" y="53" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 63px; margin-left: 126px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#0000ff">Real Relationship</font></div></div></div></foreignObject><text x="145" y="67" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Real R...</text></switch></g><path d="M 89 227 L 89 143" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 137 227 L 137 107" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 185 227 L 185 113" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 233 227 L 233 143" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 281 227 L 281 145" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><rect x="257" y="89" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 99px; margin-left: 258px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#ff1900">Interpolation between LUT points  </font></div></div></div></foreignObject><text x="277" y="103" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Interp...</text></switch></g><path d="M 329 227 L 329 107" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 95.37 209 L 130.63 209" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90.12 209 L 97.12 205.5 L 95.37 209 L 97.12 212.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 135.88 209 L 128.88 212.5 L 130.63 209 L 128.88 205.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 143.37 209 L 178.63 209" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 138.12 209 L 145.12 205.5 L 143.37 209 L 145.12 212.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 183.88 209 L 176.88 212.5 L 178.63 209 L 176.88 205.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 191.37 209 L 226.63 209" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 186.12 209 L 193.12 205.5 L 191.37 209 L 193.12 212.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 231.88 209 L 224.88 212.5 L 226.63 209 L 224.88 205.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 239.37 209 L 274.63 209" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 234.12 209 L 241.12 205.5 L 239.37 209 L 241.12 212.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 279.88 209 L 272.88 212.5 L 274.63 209 L 272.88 205.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 46.37 209 L 81.63 209" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 41.12 209 L 48.12 205.5 L 46.37 209 L 48.12 212.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 86.88 209 L 79.88 212.5 L 81.63 209 L 79.88 205.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 287.37 209 L 322.63 209" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 282.12 209 L 289.12 205.5 L 287.37 209 L 289.12 212.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 327.88 209 L 320.88 212.5 L 322.63 209 L 320.88 205.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 335.37 209 L 370.63 209" fill="none" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 330.12 209 L 337.12 205.5 L 335.37 209 L 337.12 212.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><path d="M 375.88 209 L 368.88 212.5 L 370.63 209 L 368.88 205.5 Z" fill="#b3b3b3" stroke="#b3b3b3" stroke-miterlimit="10" pointer-events="all"/><rect x="141" y="161" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 171px; margin-left: 142px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#b3b3b3">Regular Intervals</font></div></div></div></foreignObject><text x="161" y="175" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Regula...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg></div>
</html></p>
<p>The red line represents the relationship between the data converter values and physical properties. The points of contact between the red and blue line represent the points stored in the LUT. Values between these LUT points are linearly interpolated from them. Naturally the least amount of error is present where the blue and red lines are coincident. However as the data converters and the circuits that follow in this device are mostly linear, very little error is present in values between two interpolation points. 
It is intentional that the points in the LUT have a regular interval on the axis that is being translated from. The reason for this is that there is less of a processing overhead in finding which interval a given value falls in than if the intervals were irregularly sized. This is important as the current to DAC value needs to be done fast to allow for current updates during a stimulation event. Additionally, due to the large amount of ADC data that needs to be translated, processing overhead needs to be small.</p>
<h4 id="what-does-the-eeprom-store">What does the EEPROM Store?</h4>
<p>While it may seem logical that the answer to this question is simply the LUTs as described in the section above, this is not the case. Rather, the user can store a <strong>calibration point pair</strong>, which consists of either a <strong>DAC or ADC value</strong> and its corresponding physical property, either <strong>Voltage or Current</strong>. The user can choose to store as little or as many points as they will to a certain limit as defined by the firmware (at the time of writing this is 60 points per data converter). However, storing no or only one calibration point is useless, as storing no points results in every value mapping to zero and storing a single point results in every value mapping to the single point. In both cases the relationship would be flat. Two points and beyond becomes useful. 
<html>
<div style="text-align:center;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="523px" height="104px" viewBox="-0.5 -0.5 523 104" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2020-07-01T15:00:47.048Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36&quot; version=&quot;13.3.5&quot; etag=&quot;tPLtblrhuD0cSte3Wq6_&quot; type=&quot;google&quot;&gt;&lt;diagram id=&quot;iLx0e6KhgAtqB3saFtV_&quot;&gt;7VpLs9ogFP41bjs8kpu4vNpru+lMZ1x0zSRcwxSDQ/Cq/fUlBvJCrdrEx1UXTvIBB/i+A+eQZIDH8/U3SRbJDxFTPkAgXg/w1wFCIQz1fw5sCsDDXgHMJIsLCFbAlP2hBgQGXbKYZo2KSgiu2KIJRiJNaaQaGJFSrJrV3gVv9rogM+oA04hwF/3FYpWYafmgwr9TNktszxCYkjmxlQ2QJSQWqxqE3wZ4LIVQxdV8PaY8587yUrSb7CktByZpqo5pgIoGH4QvzdzMuNTGTpam8WvOmb6LOMkyFg3wKFFzrgGoL4sGNHYoq8YAy5lpj6BiTpXc6CqrijtLXVKjzWKScqLYR9M8MRLOSnNlDz8F0x0jYLzNUm19DaAvoPZr2cvEUkbUmKgTd9gqxqBpRxE5o8qxoy9qFFTQVpbdEuGnROdJBHFwitnuFPNOUiwVKW3KlSkpftOx4EJua+PJxHsBuCyxew66B2lhL9LCk8x2J63vSKtpAlvLmb6YKiFp7Kit6Fodkti4wDvjvAURzmZpvqy1mlTjow8qFdOR6NUUzFkc592MVglTdLogUd7nSoddjUmxTGOaDx2UrpIboOtTncWq2V5Rho+aL5Wxru5MCOz3m4YaB6h/+fz7IPT72Qj9iwWr4CnSuQnFy5WiVfiMVjVtm3EFB+hMNb1/GOpOv6GjH3ykkAT9K8YkeyD9zPsdCvvZ78KLBSWbLD5VOlklPLxSVILoGZZq4raiyRCcK2dr0Xn9LTr3ucVDxSUUXjMuHfMIgnO2yPbxUROgzrVeRwAHYDLZJ0wHzMGg5e02M24w5xIHuyDOPeDfD3FoGDaJC3a5XE/EHXM8v1XicNvjbPZ+CeIe4MjswV6Sk7bZPlPI007JT5Uqs77z0PBSKaR7Mj6k2f+lkLvyh1uWuqOE0m+/BzsyodSkk02t2sKkhXsH3D4tBsOWdxQWz/UVO41HzVY9eMVs1Q73LnMHzyZZpWd6O5hziesid7A83SVxPmgR512QuGNeqt8qcZ59wWyJC1FfxOnb6luUYlutPujBb38B&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><path d="M 7 79 L 7 13.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 7 8.12 L 10.5 15.12 L 7 13.37 L 3.5 15.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 7 79 L 117.63 79" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 122.88 79 L 115.88 82.5 L 117.63 79 L 115.88 75.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 8 79 L 98 79" fill="none" stroke="#ff4603" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><rect x="14" y="82" width="100" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 92px; margin-left: 15px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">0 Points Stored</div></div></div></foreignObject><text x="64" y="96" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">0 Points Stored</text></switch></g><path d="M 137 79 L 137 13.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 137 8.12 L 140.5 15.12 L 137 13.37 L 133.5 15.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 137 79 L 247.63 79" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 252.88 79 L 245.88 82.5 L 247.63 79 L 245.88 75.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 138 49 L 228 49" fill="none" stroke="#ff4603" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><rect x="144" y="82" width="100" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 92px; margin-left: 145px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">1 Points Stored</div></div></div></foreignObject><text x="194" y="96" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">1 Points Stored</text></switch></g><path d="M 267 79 L 267 13.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 267 8.12 L 270.5 15.12 L 267 13.37 L 263.5 15.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 267 79 L 377.63 79" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 382.88 79 L 375.88 82.5 L 377.63 79 L 375.88 75.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 268 67 L 377 17" fill="none" stroke="#ff4603" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><rect x="274" y="82" width="100" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 92px; margin-left: 275px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">1 Points Stored</div></div></div></foreignObject><text x="324" y="96" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">1 Points Stored</text></switch></g><ellipse cx="163" cy="49" rx="5" ry="5" fill="#0370ff" stroke="none" pointer-events="all"/><ellipse cx="290" cy="57" rx="5" ry="5" fill="#0370ff" stroke="none" pointer-events="all"/><ellipse cx="363" cy="23" rx="5" ry="5" fill="#0370ff" stroke="none" pointer-events="all"/><path d="M 397 79 L 397 13.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 397 8.12 L 400.5 15.12 L 397 13.37 L 393.5 15.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 397 79 L 507.63 79" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 512.88 79 L 505.88 82.5 L 507.63 79 L 505.88 75.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 398 67 L 467 56 L 507 17" fill="none" stroke="#ff4603" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><rect x="404" y="82" width="100" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 92px; margin-left: 405px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">1 Points Stored</div></div></div></foreignObject><text x="454" y="96" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">1 Points Stored</text></switch></g><ellipse cx="467" cy="56" rx="5" ry="5" fill="#0370ff" stroke="none" pointer-events="all"/><ellipse cx="497" cy="26" rx="5" ry="5" fill="#0370ff" stroke="none" pointer-events="all"/><ellipse cx="416" cy="64" rx="5" ry="5" fill="#0370ff" stroke="none" pointer-events="all"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg></div></html></p>
<p>It is very likely that the number of calibration points may be lower than the number of entries that the LUT table requires and that the spacing between the pairs are not regular, making them not suitable for placement in the table. Some conversion process has to be performed to achieve this, and this will be discussed further on on this page. However there are benefits to storing arbitrary calibration point pairs:</p>
<ul>
<li>More intuitive from the user perspective (don't need to know what is happening behind)</li>
<li>The user does not have to be aware of specific points they need to store</li>
<li>They can control either value in the pair and and measure the other (one side of the pair may be easier to control than the other)</li>
</ul>
<h5 id="note-on-similar-points">Note on Similar Points</h5>
<p>The user is not restricted from storing any calibration pair they desire, this means the user can store pairs where:</p>
<ul>
<li>Both the data converter and electrical properties are identical to another pair</li>
<li>The same data converter value paired with different electrical property values</li>
<li>The same electrical property values paired with different data converter values</li>
</ul>
<p>The device will handle all three cases without malfunctioning, in the event there are <strong>identical calibration pairs</strong>, the calibration <strong>relationship will look no different</strong> as if the identical points were not present. In the other two scenarios things get a bit more complicated since the treatment depends on whether the data converter value or the electrical property value is the independent variable. For DAC calibration points, the electrical property is the independent variable, since current values are mapped to DAC values (ie. every current value can only map to a single DAC value, but the same DAC value can map to multiple current values). For the ADCs the opposite is true, since the ADC value is mapped towards an electrical property. <strong>The firmware will only use the first calibration point to appear in EEPROM out of a set of points with equal independent variables</strong>.</p>
<table>
<thead>
<tr>
<th></th>
<th>Pair 1</th>
<th>Pair 2</th>
<th>Pair 3</th>
<th>Pair 4</th>
<th>Pair 5</th>
<th>Pair 6</th>
</tr>
</thead>
<tbody>
<tr>
<td>Output Current</td>
<td>-3mA</td>
<td>-0mA</td>
<td>0mA</td>
<td>0.1mA</td>
<td>3mA</td>
<td>2mA</td>
</tr>
<tr>
<td>DAC Value</td>
<td>0</td>
<td>2047</td>
<td>2100</td>
<td>2047</td>
<td>4095</td>
<td>3000</td>
</tr>
</tbody>
</table>
<p>The pairs in green are used to perform the LUT table conversion, the pair in red is ignored as the DAC cannot be set to both 2047 and 2100 at the same time. The reason 2100 is ignored is simply because it was the first value in the EEPROM to be stored for 0mA. It is a first come first serve basis.</p>
<h4 id="eeprom-to-lut-table-conversion">EEPROM to LUT Table Conversion</h4>
<p>Every time the device starts, the calibration pairs on the EEPROM are processed to produce values for the LUT tables in memory. This also occurs when updating the calibration using the required shell commands. Essentially the points in the LUT table are filled with points interpolated between the calibration pairs stored in the EEPROM. While this may seem like an inefficient way to store the calibration data, since it is quite likely that there will be a lower number of calibration points stored in EEPROM than will be stored in the LUT table, using the LUT table to perform a translation is still faster than interpolating even between only a few calibration pairs in the way that they are stored in EEPROM. </p>
<h4 id="fast-translation-using-lut">Fast Translation Using LUT</h4>
<p>The whole paradigm revolves around the fact that faster translations can occur between data converter and physical property values when using a regularly spaced LUT rather than an irregularly spaced one. The increased speed comes in finding the interval in which the input point falls not in the actual interpolation. When the intervals are evenly spaced, a simple arithmetic operation can be used to determine the correct interval, when the intervals are irregularly, a search needs to be performed, which depending on implementation can take significantly more time. Additionally the time taken is somewhat dependant on the size of the LUT when irregularly spaced.</p></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
        </p>

        
        
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>

    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
        
    <script>hljs.initHighlightingOnLoad();</script>
    

    <script>var base_url = ".."</script>
    
    <script src="../js/base.js"></script>
    <script src="../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
